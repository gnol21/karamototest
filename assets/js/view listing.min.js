$(document).ready((function(){function e(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function a(){$("#buyerName").val(""),$("#buyerAddress").val(""),$("#buyerPhone").val(""),$("#buyerEmail").val(""),$("#toNextS").addClass("disabled")}$("#listingTable table tbody").empty(),$.ajax({url:"https://iptv.givethanksgrocers.com/karamoto/view_listing_api.php",type:"GET",dataType:"json",success:function(a){0!==a.length?(a.forEach((function(a,t){var s=e(a.Price),o=e(a.Mileage),l=`\n                        <tr data-id="${a.VehicleID}">\n                            <td>${t+1}</td>\n                            <td>${a.Make}</td>\n                            <td>${a.Model}</td>\n                            <td>${a.Year}</td>\n                            <td>${o}</td>\n                            <td>${s}</td>\n                            <td>${a.Conditions}</td>\n                            <td><button class="btn btn-dark btn-sm view-details-btn" type="button" style="margin-left: 3px;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1em" height="1em" fill="currentColor" style="font-size: 16px;">\n    \x3c!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --\x3e\n    <path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"></path>\n</svg></button></td>\n                        </tr>`;$("#listingTable table tbody").append(l)})),$(".view-details-btn").click((function(){!function(a){$.ajax({url:"https://iptv.givethanksgrocers.com/karamoto/view_vehicle_api.php?VehicleID="+a,type:"GET",dataType:"json",success:function(a){if(0===a.length)return $("#responseMessage").text("No vehicle details found."),void $("#responseModal").modal("show");var t=a[0];$("#vehicleMake").val(t.Make),$("#vehicleModel").val(t.Model),$("#vehicleYear").val(t.Year),$("#vehicleMileage").val(e(t.Mileage)),$("#vehiclePrice").val(e(t.Price)),$("#vehicleCondition").val(t.Conditions),$("#vehicleVIN").val(t.VIN),$("#vehicleDescription").text(t.Description),$("#vehicleDateListed").val(t.DateListed),$("#vehicleIDH").val(t.VehicleID),$("#selerIDH").val(t.SellerID),$("#vehicleMake-1").val(t.Make),$("#vehicleModel-1").val(t.Model),$("#vehiclePrice-1").val(e(t.Price)),$("#priceIDH").val(t.Price),$("#vehicleVIN-1").val(t.VIN),$("#vehicleYear-1").val(t.Year),$("#vehicleModal").modal("show"),$("#vehicleModalLabel-2").text("Confirm Sale")},error:function(){console.log("Error fetching vehicle details"),$("#responseMessage").text("Error fetching vehicle details."),$("#responseModal").modal("show")}})}($(this).closest("tr").data("id"))}))):$("#listingTable table tbody").append('<tr><td colspan="8" class="text-center">No listings found.</td></tr>')},error:function(){console.log("Error fetching listing data")}}),$("#toNextS").addClass("disabled"),$("#userForm").on("submit",(function(e){e.preventDefault();var a={Name:$("#buyerName").val(),Address:$("#buyerAddress").val(),PhoneNumber:$("#buyerPhone").val(),Email:$("#buyerEmail").val(),UserType:"Buyer",DateRegistered:(new Date).toISOString()};$.ajax({url:"https://iptv.givethanksgrocers.com/karamoto/add_user_api.php",type:"POST",contentType:"application/json",data:JSON.stringify(a),success:function(e){var a="string"==typeof e?JSON.parse(e):e;if("Buyer added successfully"===a.message){var t=a.data.Name,s=a.data.UserId;$("#responseMessage").text("Buyer added successfully. Name: "+t),$("#responseModal").modal("show"),$("#buyerName-2").val(t),$("#buyerIDH").val(s),$("#toNextS").removeClass("disabled")}else $("#responseMessage").text(a.message),$("#responseModal").modal("show")},error:function(e){var a=JSON.parse(e.responseText);$("#responseMessage").text(a.message),$("#responseModal").modal("show")}})})),$("#searchInput").on("input",(function(){var e=$(this).val();$.ajax({url:"https://iptv.givethanksgrocers.com/karamoto/add_user_api.php",type:"POST",contentType:"application/json",data:JSON.stringify({action:"search",query:e}),success:function(e){var t;"Search successful"===e.message&&e.data.length>0?(t=e.data[0],$("#buyerIDH").val(t.UserID),$("#buyerName").val(t.Name),$("#buyerName-2").val(t.Name),$("#buyerAddress").val(t.Address),$("#buyerPhone").val(t.PhoneNumber),$("#buyerEmail").val(t.Email),$("#toNextS").removeClass("disabled")):($("#toNextS").addClass("disabled"),a())},error:function(e){var a=JSON.parse(e.responseText);$("#responseMessage").text(a.message),$("#responseModal").modal("show")}})})),$("#toNextSClear").click((function(){a()})),$("#addSale").on("submit",(function(e){e.preventDefault();var t=$("#paymentMethod option:selected").text(),s={VehicleID:$("#vehicleIDH").val(),BuyerID:$("#buyerIDH").val(),SalePrice:$("#priceIDH").val(),SaleDate:$("#SaleDate").val(),PaymentMethod:t};$.ajax({url:"https://iptv.givethanksgrocers.com/karamoto/sales_api.php",type:"POST",contentType:"application/json",data:JSON.stringify(s),success:function(e){var t="string"==typeof e?JSON.parse(e):e;"Sale recorded successfully"===t.message&&($("#vehicleIDH").val(""),$("#buyerIDH").val(""),$("#selerIDH").val(""),$("#priceIDH").val(),a(),$("#toSales").modal("toggle"),$("#responseMessage").text(t.message),$("#responseModal").modal("show"),window.location.href="sales.html")},error:function(e){var a=JSON.parse(e.responseText);$("#responseMessage").text(a.message),$("#responseModal").modal("show")}})}))}));