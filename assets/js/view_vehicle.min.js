$(document).ready((function(){let e=!1,t=null;function s(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function n(){$("#vehicleTable tbody").empty(),$.ajax({url:"http://localhost/view_vehicle_api.php",type:"GET",dataType:"json",success:function(o){0!==o.length?(o.forEach((function(e,t){var n=s(e.Price),o=s(e.Mileage),i=parseInt(e.isListed)?'<button class="btn btn-dark btn-sm remove-from-listing" type="button" style="margin-left: 3px;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="-32 0 512 512" width="1em" height="1em" fill="currentColor" style="font-size: 18px;">\n    \x3c!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --\x3e\n    <path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm88 200H296c13.3 0 24 10.7 24 24s-10.7 24-24 24H152c-13.3 0-24-10.7-24-24s10.7-24 24-24z"></path>\n</svg></button>':'<button class="btn btn-success btn-sm add-to-listing" type="button" style="margin-left: 3px;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="-32 0 512 512" width="1em" height="1em" fill="currentColor" style="font-size: 18px;">\n    \x3c!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --\x3e\n    <path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM200 344V280H136c-13.3 0-24-10.7-24-24s10.7-24 24-24h64V168c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24H248v64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"></path>\n</svg></button>',l=`<tr data-id="${e.VehicleID}">\n                        <td>${t+1}</td>\n                        <td>${e.Make}</td>\n                        <td>${e.Model}</td>\n                        <td>${e.Year}</td>\n                        <td>${e.VIN}</td>\n                        <td>${o}</td>\n                        <td>${n}</td>\n                        <td>${e.Conditions}</td>\n                        <td>\n                            ${i}\n                            <button class="btn btn-warning btn-sm btn-edit" type="button" style="margin-left: 3px;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -32 576 576" width="1em" height="1em" fill="currentColor" style="font-size: 18px;">\n    \x3c!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --\x3e\n    <path d="M0 64C0 28.7 28.7 0 64 0H224V128c0 17.7 14.3 32 32 32H384V285.7l-86.8 86.8c-10.3 10.3-17.5 23.1-21 37.2l-18.7 74.9c-2.3 9.2-1.8 18.8 1.3 27.5H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0L384 128zM549.8 235.7l14.4 14.4c15.6 15.6 15.6 40.9 0 56.6l-29.4 29.4-71-71 29.4-29.4c15.6-15.6 40.9-15.6 56.6 0zM311.9 417L441.1 287.8l71 71L382.9 487.9c-4.1 4.1-9.2 7-14.9 8.4l-60.1 15c-5.5 1.4-11.2-.2-15.2-4.2s-5.6-9.7-4.2-15.2l15-60.1c1.4-5.6 4.3-10.8 8.4-14.9z"></path>\n</svg></button>\n                            <button class="btn btn-danger btn-sm delete-btn" type="button" style="margin-left: 3px;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="-32 0 512 512" width="1em" height="1em" fill="currentColor" style="font-size: 18px;">\n    \x3c!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --\x3e\n    <path d="M135.2 17.7C140.6 6.8 151.7 0 163.8 0H284.2c12.1 0 23.2 6.8 28.6 17.7L320 32h96c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 96 0 81.7 0 64S14.3 32 32 32h96l7.2-14.3zM32 128H416V448c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V128zm96 64c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16z"></path>\n</svg></button>\n                        </td>\n                    </tr>`;$("#vehicleTable tbody").append(l)})),$(".add-to-listing").click((function(){!function(e){$.ajax({url:"http://localhost/add_listing_api.php",type:"POST",contentType:"application/json",data:JSON.stringify({VehicleID:e,SellerID:1,ListingDate:(new Date).toISOString().slice(0,19).replace("T"," "),Status:"Available"}),success:function(e){$("#response").removeClass("alert-danger").addClass("alert-success").text(e.message).show(),n()},error:function(e){var t=JSON.parse(e.responseText);$("#response").removeClass("alert-success").addClass("alert-danger").text(t.error).show()}})}($(this).closest("tr").data("id"))})),$(".remove-from-listing").click((function(){!function(e){$.ajax({url:"http://localhost/remove_listing_api.php",type:"POST",contentType:"application/json",data:JSON.stringify({VehicleID:e}),success:function(e){$("#response").removeClass("alert-danger").addClass("alert-success").text(e.message).show(),n()},error:function(e){var t=JSON.parse(e.responseText);$("#response").removeClass("alert-success").addClass("alert-danger").text(t.error).show()}})}($(this).closest("tr").data("id"))})),$(".delete-btn").click((function(){var e=$(this).closest("tr"),t=e.data("id");$("#deleteConfirmModal").modal("show"),$("#confirmDeleteBtn").click((function(){!function(e,t){$.ajax({url:"http://localhost/del_vehicle_api.php",type:"POST",data:{VehicleID:e},success:function(e){$("#responseMessage").text(e.message||"Vehicle deleted successfully."),$("#responseModal").modal("show"),t.remove()},error:function(){$("#responseMessage").text("Error deleting vehicle."),$("#responseModal").modal("show")}})}(t,e),$("#deleteConfirmModal").modal("hide")}))})),$(".btn-edit").click((function(){!function(s){e=!0,t=s.ID,$("#vehicleModalLabel").text("Edit Vehicle"),$("#make").val(s.Make),$("#model").val(s.Model),$("#year").val(s.Year),$("#vin").val(s.VIN),$("#mileage").val(s.Mileage),$("#price").val(s.Price),$("#description").val(s.Description),$("#conditions").val(s.Conditions),$("#response").hide(),$("#submitBtn").text("Save Changes"),$("#vehicleModal").modal("show")}({ID:$(this).closest("tr").data("id"),Make:$(this).closest("tr").find("td:nth-child(2)").text(),Model:$(this).closest("tr").find("td:nth-child(3)").text(),Year:$(this).closest("tr").find("td:nth-child(4)").text(),VIN:$(this).closest("tr").find("td:nth-child(5)").text(),Mileage:$(this).closest("tr").find("td:nth-child(6)").text().replace(/,/g,""),Price:$(this).closest("tr").find("td:nth-child(7)").text().replace(/,/g,""),Conditions:$(this).closest("tr").find("td:nth-child(8)").text()})}))):$("#vehicleTable tbody").append('<tr><td colspan="9" class="text-center">No vehicles found.</td></tr>')},error:function(){console.log("Error fetching data"),$("#responseMessage").text("Error fetching vehicle data."),$("#responseModal").modal("show")}})}$("#vehicleForm").on("submit",(function(s){if(s.preventDefault(),this.checkValidity()){$("#submitBtn").prop("disabled",!0),$("#loading").show();var o={SellerID:1,Make:$("#make").val(),Model:$("#model").val(),Year:$("#year").val(),VIN:$("#vin").val(),Mileage:$("#mileage").val(),Price:$("#price").val(),Description:$("#description").val(),Conditions:$("#conditions").val()};e&&(o.ID=t);var i={url:"http://localhost/reg_vehicle_api.php",type:"POST",contentType:"application/json",data:JSON.stringify(o),success:function(e){$("#response").removeClass("alert-danger").addClass("alert-success").text(e.message).show(),$("#vehicleForm")[0].reset(),n(),setTimeout((function(){$("#response").fadeOut().empty()}),1e3)},error:function(e){var t=JSON.parse(e.responseText);$("#response").removeClass("alert-success").addClass("alert-danger").text(t.error).show(),setTimeout((function(){$("#response").fadeOut().empty()}),1e3)},complete:function(){$("#submitBtn").prop("disabled",!1),$("#loading").hide(),e&&$("#vehicleModal").modal("hide")}};e&&(o.ID=t,i.url="http://localhost/edit_vehicle_api.php",i.type="PUT"),$.ajax(i)}else this.reportValidity()})),$("#addVehicleBtn").on("click",(function(){e=!1,$("#vehicleModalLabel").text("Register a Vehicle"),$("#vehicleForm")[0].reset(),$("#response").hide(),$("#submitBtn").text("Submit"),$("#vehicleModal").modal("show")})),n()}));