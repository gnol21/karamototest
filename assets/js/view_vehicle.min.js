$(document).ready((function(){let e=!1,t=null;function s(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function a(){$("#vehicleTable tbody").empty(),$.ajax({url:"http://localhost/view_vehicle_api.php",type:"GET",dataType:"json",success:function(l){0!==l.length?(l.forEach((function(e,t){var a=s(e.Price),l=s(e.Mileage),n=parseInt(e.isListed)?'<button class="btn btn-dark btn-sm remove-from-listing" type="button" style="margin-left: 3px;"><svg class="bi bi-bookmark-dash-fill" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" style="font-size: 16px;">\n    <path fill-rule="evenodd" d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5M6 6a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1z"></path>\n</svg></button>':'<button class="btn btn-success btn-sm add-to-listing" type="button" style="margin-left: 3px;"><svg class="bi bi-bookmark-plus-fill" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" style="font-size: 16px;">\n    <path fill-rule="evenodd" d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5m6.5-11a.5.5 0 0 0-1 0V6H6a.5.5 0 0 0 0 1h1.5v1.5a.5.5 0 0 0 1 0V7H10a.5.5 0 0 0 0-1H8.5z"></path>\n</svg></button>',i=`<tr data-id="${e.VehicleID}">\n                        <td>${t+1}</td>\n                        <td>${e.Make}</td>\n                        <td>${e.Model}</td>\n                        <td>${e.Year}</td>\n                        <td>${e.VIN}</td>\n                        <td>${l}</td>\n                        <td>${a}</td>\n                        <td>${e.Conditions}</td>\n                        <td>\n                            ${n}\n                            <button class="btn btn-warning btn-sm btn-edit" type="button" style="margin-left: 3px;"><svg class="bi bi-pencil-square" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" style="font-size: 18px;">\n    <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"></path>\n    <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"></path>\n</svg></button>\n                            <button class="btn btn-danger btn-sm delete-btn" type="button" style="margin-left: 3px;"><svg class="bi bi-trash-fill" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" style="font-size: 18px;">\n    <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"></path>\n</svg></button>\n                        </td>\n                    </tr>`;$("#vehicleTable tbody").append(i)})),$(".add-to-listing").click((function(){!function(e){$.ajax({url:"http://localhost/add_listing_api.php",type:"POST",contentType:"application/json",data:JSON.stringify({VehicleID:e,SellerID:1,ListingDate:(new Date).toISOString().slice(0,19).replace("T"," "),Status:"Available"}),success:function(e){$("#response").removeClass("alert-danger").addClass("alert-success").text(e.message).show(),a()},error:function(e){var t=JSON.parse(e.responseText);$("#response").removeClass("alert-success").addClass("alert-danger").text(t.error).show()}})}($(this).closest("tr").data("id"))})),$(".remove-from-listing").click((function(){!function(e){$.ajax({url:"http://localhost/remove_listing_api.php",type:"POST",contentType:"application/json",data:JSON.stringify({VehicleID:e}),success:function(e){$("#response").removeClass("alert-danger").addClass("alert-success").text(e.message).show(),a()},error:function(e){var t=JSON.parse(e.responseText);$("#response").removeClass("alert-success").addClass("alert-danger").text(t.error).show()}})}($(this).closest("tr").data("id"))})),$(".delete-btn").click((function(){var e=$(this).closest("tr"),t=e.data("id");$("#deleteConfirmModal").modal("show"),$("#confirmDeleteBtn").click((function(){!function(e,t){$.ajax({url:"http://localhost/del_vehicle_api.php",type:"POST",data:{VehicleID:e},success:function(e){$("#responseMessage").text(e.message||"Vehicle deleted successfully."),$("#responseModal").modal("show"),t.remove()},error:function(){$("#responseMessage").text("Error deleting vehicle."),$("#responseModal").modal("show")}})}(t,e),$("#deleteConfirmModal").modal("hide")}))})),$(".btn-edit").click((function(){!function(s){e=!0,t=s.ID,$("#vehicleModalLabel").text("Edit Vehicle"),$("#make").val(s.Make),$("#model").val(s.Model),$("#year").val(s.Year),$("#vin").val(s.VIN),$("#mileage").val(s.Mileage),$("#price").val(s.Price),$("#description").val(s.Description),$("#conditions").val(s.Conditions),$("#response").hide(),$("#submitBtn").text("Save Changes"),$("#vehicleModal").modal("show")}({ID:$(this).closest("tr").data("id"),Make:$(this).closest("tr").find("td:nth-child(2)").text(),Model:$(this).closest("tr").find("td:nth-child(3)").text(),Year:$(this).closest("tr").find("td:nth-child(4)").text(),VIN:$(this).closest("tr").find("td:nth-child(5)").text(),Mileage:$(this).closest("tr").find("td:nth-child(6)").text().replace(/,/g,""),Price:$(this).closest("tr").find("td:nth-child(7)").text().replace(/,/g,""),Conditions:$(this).closest("tr").find("td:nth-child(8)").text()})}))):$("#vehicleTable tbody").append('<tr><td colspan="9" class="text-center">No vehicles found.</td></tr>')},error:function(){console.log("Error fetching data"),$("#responseMessage").text("Error fetching vehicle data."),$("#responseModal").modal("show")}})}$("#vehicleForm").on("submit",(function(s){if(s.preventDefault(),this.checkValidity()){$("#submitBtn").prop("disabled",!0),$("#loading").show();var l={SellerID:1,Make:$("#make").val(),Model:$("#model").val(),Year:$("#year").val(),VIN:$("#vin").val(),Mileage:$("#mileage").val(),Price:$("#price").val(),Description:$("#description").val(),Conditions:$("#conditions").val()};e&&(l.ID=t);var n={url:"http://localhost/reg_vehicle_api.php",type:"POST",contentType:"application/json",data:JSON.stringify(l),success:function(e){$("#response").removeClass("alert-danger").addClass("alert-success").text(e.message).show(),$("#vehicleForm")[0].reset(),a(),setTimeout((function(){$("#response").fadeOut().empty()}),1e3)},error:function(e){var t=JSON.parse(e.responseText);$("#response").removeClass("alert-success").addClass("alert-danger").text(t.error).show(),setTimeout((function(){$("#response").fadeOut().empty()}),1e3)},complete:function(){$("#submitBtn").prop("disabled",!1),$("#loading").hide(),e&&$("#vehicleModal").modal("hide")}};e&&(l.ID=t,n.url="http://localhost/edit_vehicle_api.php",n.type="PUT"),$.ajax(n)}else this.reportValidity()})),$("#addVehicleBtn").on("click",(function(){e=!1,$("#vehicleModalLabel").text("Register a Vehicle"),$("#vehicleForm")[0].reset(),$("#response").hide(),$("#submitBtn").text("Submit"),$("#vehicleModal").modal("show")})),a()}));